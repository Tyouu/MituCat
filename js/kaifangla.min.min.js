var app=angular.module("kaifanla",["ng","ngRoute"]);app.config(function(b){b.when("/Start",{templateUrl:"tpl/start.html"}).when("/Main",{templateUrl:"tpl/main.html",controller:"mainCtrl"}).when("/Detail/:did",{templateUrl:"tpl/detail.html",controller:"detailCtrl"}).when("/Order/:id",{templateUrl:"tpl/order.html",controller:"orderCtrl"}).when("/MyOrder",{templateUrl:"tpl/myOrder.html",controller:"myOrderCtrl"}).otherwise({redirectTo:"/Start"})});app.controller("bodyCtrl",["$scope","$location",function(d,c){d.jump=function(a){c.path(a)}}]);app.controller("mainCtrl",["$scope","$http",function(d,c){d.hasMore=true;d.kw="";c.get("date/dish_getbypage.php").success(function(a){console.log(a);d.dishList=a});d.loadMore=function(){c.get("date/dish_getbypage.php?start="+d.dishList.length).success(function(a){if(a.length<5){d.hasMore=false}d.dishList=d.dishList.concat(a)})};d.$watch("kw",function(){if(d.kw.length>0){c.get("date/dish_getbykw.php?kw="+d.kw).success(function(a){console.log(a);if(a.length>0){d.dishList=a}})}})}]);app.controller("detailCtrl",["$scope","$routeParams","$http",function(e,d,f){f.get("date/dish_getbyid.php?did="+d.did).success(function(a){console.log(a);e.dish=a[0]})}]);app.controller("orderCtrl",["$scope","$routeParams","$http","$httpParamSerializerJQLike",function(f,h,g,e){console.log(h);f.order={user_name:"",sex:1,phone:"",addr:"",did:h.id};f.submitOrder=function(){console.log(f.order);var a=e(f.order);console.log(a);g.get("date/order_add.php?"+a).success(function(b){console.log(b);if(b.msg=="success"){f.orderResult="下单成功，订单编号为"+b.oid;sessionStorage.setItem("phone",f.order.phone)}else{f.orderResult="下单失败"}})}}]);app.controller("myOrderCtrl",["$scope","$http",function(e,f){var d=sessionStorage.getItem("phone");console.log(d);f.get("date/order_getbyphone.php?phone="+d).success(function(a){console.log(a);e.orderList=a})}]);