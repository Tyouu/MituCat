var app=angular.module("kaifanla",["ng","ngRoute"]);app.config(function(a){a.when("/Start",{templateUrl:"tpl/start.html"}).when("/Main",{templateUrl:"tpl/main.html",controller:"mainCtrl"}).when("/Detail/:did",{templateUrl:"tpl/detail.html",controller:"detailCtrl"}).when("/Order/:id",{templateUrl:"tpl/order.html",controller:"orderCtrl"}).when("/MyOrder",{templateUrl:"tpl/myOrder.html",controller:"myOrderCtrl"}).otherwise({redirectTo:"/Start"})});app.controller("bodyCtrl",["$scope","$location",function(a,b){a.jump=function(c){b.path(c)}}]);app.controller("mainCtrl",["$scope","$http",function(a,b){a.hasMore=true;a.kw="";b.get("date/dish_getbypage.php").success(function(c){console.log(c);a.dishList=c});a.loadMore=function(){b.get("date/dish_getbypage.php?start="+a.dishList.length).success(function(c){if(c.length<5){a.hasMore=false}a.dishList=a.dishList.concat(c)})};a.$watch("kw",function(){if(a.kw.length>0){b.get("date/dish_getbykw.php?kw="+a.kw).success(function(c){console.log(c);if(c.length>0){a.dishList=c}})}})}]);app.controller("detailCtrl",["$scope","$routeParams","$http",function(a,b,c){c.get("date/dish_getbyid.php?did="+b.did).success(function(d){console.log(d);a.dish=d[0]})}]);app.controller("orderCtrl",["$scope","$routeParams","$http","$httpParamSerializerJQLike",function(a,c,d,b){console.log(c);a.order={user_name:"",sex:1,phone:"",addr:"",did:c.id};a.submitOrder=function(){console.log(a.order);var e=b(a.order);console.log(e);d.get("date/order_add.php?"+e).success(function(f){console.log(f);if(f.msg=="success"){a.orderResult="下单成功，订单编号为"+f.oid;sessionStorage.setItem("phone",a.order.phone)}else{a.orderResult="下单失败"}})}}]);app.controller("myOrderCtrl",["$scope","$http",function(a,c){var b=sessionStorage.getItem("phone");console.log(b);c.get("date/order_getbyphone.php?phone="+b).success(function(d){console.log(d);a.orderList=d})}]);